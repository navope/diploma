<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <title>Measurements</title>-->
<!--  <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>-->
<!--  <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>-->
<!--  <script>-->
<!--    document.addEventListener("DOMContentLoaded", function() {-->
<!--      var socket = new SockJS('/ws');-->
<!--      var stompClient = Stomp.over(socket);-->

<!--      stompClient.connect({}, function(frame) {-->
<!--        console.log('Connected: ' + frame);-->
<!--        stompClient.subscribe('/topic/measurements', function(message) {-->
<!--          var measurement = JSON.parse(message.body);-->
<!--          document.getElementById("pressure").innerText = measurement.pressureDTO.value;-->
<!--          document.getElementById("temperature").innerText = measurement.temperatureDTO.value;-->
<!--        });-->
<!--      });-->
<!--    });-->
<!--  </script>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Live Measurements</h1>-->
<!--<p>Pressure: <span id="pressure">N/A</span></p>-->
<!--<p>Temperature: <span id="temperature">N/A</span></p>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Measurements</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
  <style>
    #alert {
      display: none;
      color: white;
      background-color: red;
      padding: 20px;
      text-align: center;
      font-size: 20px;
      margin-top: 20px;
    }
    #measurements {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1 class="text-center my-4">Live Measurements</h1>
  <div id="alert">Warning! Threshold Exceeded!</div>
  <div id="measurements" class="text-center">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Pressure: <span id="pressure">N/A</span></h5>
        <h5 class="card-title">Temperature: <span id="temperature">N/A</span></h5>
      </div>
    </div>
  </div>
</div>
<audio id="alert-sound" src="/sound/alarm.mp3" preload="auto"></audio>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var socket = new SockJS('/ws');
    var stompClient = Stomp.over(socket);
    var alertThreshold = { pressure: 100, temperature: 30 }; // Заданные пороги

    stompClient.connect({}, function(frame) {
      console.log('Connected: ' + frame);
      stompClient.subscribe('/topic/measurements', function(message) {
        var measurement = JSON.parse(message.body);
        var pressure = measurement.pressureDTO.value;
        var temperature = measurement.temperatureDTO.value;
        document.getElementById("pressure").innerText = pressure;
        document.getElementById("temperature").innerText = temperature;

        if (pressure > alertThreshold.pressure || temperature > alertThreshold.temperature) {
          document.getElementById("alert").style.display = "block";
          document.getElementById("alert-sound").play();
        } else {
          document.getElementById("alert").style.display = "none";
        }
      });
    });
  });
</script>
</body>
</html>

